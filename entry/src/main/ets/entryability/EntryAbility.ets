import { AbilityConstant, UIAbility, Want } from '@kit.AbilityKit';
import { hilog } from '@kit.PerformanceAnalysisKit';
import { window } from '@kit.ArkUI';
import { AdvertClass, defaultAd, UserSettingClass } from '@common/basic';


// é¢å‘å¯¹è±¡-ä¸‰å¤§ç‰¹æ€§: å°è£…\ç»§æ‰¿\å¤šæ€
export default class EntryAbility extends UIAbility {
  onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void {
    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onCreate');
  }

  onDestroy(): void {
    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onDestroy');
  }

  async onWindowStageCreate(windowStage: window.WindowStage): Promise<void> {


    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onWindowStageCreate');

    // 1. æŸ¥è¯¢é…ç½®, æ˜¯å¦è¦æ˜¾ç¤ºå¹¿å‘Š
    // æ¨¡æ‹Ÿå‘è¯·æ±‚, æŸ¥è¯¢å¹¿å‘Šé…ç½®
    const ad = await new Promise<AdvertClass>((resolve) => {
      setTimeout(() => {
        resolve(defaultAd) // artTSè¿›é˜¶  resolve è¡¨ç¤ºæˆåŠŸçš„è¿”å›å€¼
      }, 500)
    })

    // å­˜åˆ°ç”¨æˆ·çš„æŒä¹…åŒ–å­˜å‚¨ä¸­
    const userSetting = new UserSettingClass(this.context)
    userSetting.setAdvert(ad)

    // å¦‚æœè¦æ˜¾ç¤ºå¹¿å‘Š-ä¸èƒ½ç›´æ¥æ˜¾ç¤ºé¦–é¡µ
    if (ad.showAd) {
      //   ğŸ’¥ğŸ’¥ å¦‚ä½•åˆ›å»ºä¸€ä¸ªå­çª—å£
      //   åˆ›å»ºå­çª—å£
      const win = await windowStage.createSubWindow('ad_window')
      await win.showWindow() // æ‰“å¼€å­çª—å£
      win.setUIContent('pages/Start/Start') // æ˜¾ç¤ºé‚£ä¸ªé¡µé¢çš„å†…å®¹åšä¸ºå­çª—å£çš„é¡µé¢
    }

    windowStage.loadContent('pages/Index');


  }

  onWindowStageDestroy(): void {
    // Main window is destroyed, release UI related resources
    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onWindowStageDestroy');
  }

  onForeground(): void {
    // Ability has brought to foreground
    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onForeground');
  }

  onBackground(): void {
    // Ability has back to background
    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onBackground');
  }
}
